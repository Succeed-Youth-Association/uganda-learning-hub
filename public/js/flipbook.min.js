
/* FlipBook Main JS - Combined from multiple modules */

// Load flipbook.swipe.min.js
document.write('<script src="/js/flipbook.swipe.min.js"><\/script>');

// Load flipbook.book3.min.js  
document.write('<script src="/js/flipbook.book3.min.js"><\/script>');

// Load flipbook.pdfservice.min.js
document.write('<script src="/js/flipbook.pdfservice.min.js"><\/script>');

// Main FlipBook initialization code will be here
(function($) {
    'use strict';

    // FlipBook jQuery plugin
    $.fn.flipBook = function(options) {
        return this.each(function() {
            if (!$(this).data('flipbook')) {
                $(this).data('flipbook', new FlipBook(this, options));
            }
        });
    };

    // Main FlipBook constructor
    function FlipBook(element, options) {
        this.element = element;
        this.$element = $(element);
        this.options = $.extend({}, FlipBook.DEFAULTS, options);
        this.init();
    }

    FlipBook.DEFAULTS = {
        pdfUrl: '',
        lightBox: true,
        layout: 3,
        currentPage: {
            vAlign: "bottom",
            hAlign: "left"
        },
        btnShare: {
            enabled: false
        },
        btnPrint: {
            enabled: true
        },
        btnDownloadPages: {
            enabled: true
        },
        btnColor: 'rgb(255,120,60)',
        sideBtnColor: 'rgb(255,120,60)',
        sideBtnSize: 60,
        sideBtnBackground: "rgba(0,0,0,.7)",
        sideBtnRadius: 60,
        btnSound: {
            vAlign: "top",
            hAlign: "left"
        },
        btnAutoplay: {
            vAlign: "top",
            hAlign: "left"
        }
    };

    FlipBook.prototype.init = function() {
        var self = this;
        
        this.$element.on('click', function(e) {
            e.preventDefault();
            self.openLightBox();
        });
    };

    FlipBook.prototype.openLightBox = function() {
        var self = this;
        
        // Create lightbox overlay
        var $overlay = $('<div>').addClass('flipbook-overlay').css({
            position: 'fixed',
            top: 0,
            left: 0,
            width: '100%',
            height: '100%',
            backgroundColor: 'rgba(0,0,0,0.9)',
            zIndex: 9999,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center'
        });

        // Create close button
        var $closeBtn = $('<button>').html('Ã—').css({
            position: 'absolute',
            top: '20px',
            right: '30px',
            backgroundColor: 'transparent',
            border: 'none',
            color: 'white',
            fontSize: '40px',
            cursor: 'pointer',
            zIndex: 10000
        });

        // Create PDF viewer container
        var $container = $('<div>').css({
            width: '90%',
            height: '90%',
            backgroundColor: 'white',
            borderRadius: '10px',
            overflow: 'hidden',
            position: 'relative'
        });

        // Create iframe for PDF
        var $iframe = $('<iframe>').attr({
            src: this.options.pdfUrl,
            width: '100%',
            height: '100%',
            frameborder: '0'
        }).css({
            border: 'none'
        });

        $container.append($iframe);
        $overlay.append($closeBtn).append($container);
        $('body').append($overlay);

        // Close functionality
        $closeBtn.on('click', function() {
            $overlay.remove();
        });

        $overlay.on('click', function(e) {
            if (e.target === $overlay[0]) {
                $overlay.remove();
            }
        });

        // ESC key to close
        $(document).on('keyup.flipbook', function(e) {
            if (e.keyCode === 27) {
                $overlay.remove();
                $(document).off('keyup.flipbook');
            }
        });
    };

    // Make FlipBook available globally
    window.FlipBook = FlipBook;

})(jQuery);
